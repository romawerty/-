###  Архитектура Аппаратного Комплекса Мониторинга

**Цель:** Реализовать распределенную систему мониторинга финансовых операций в режиме, близком к реальному времени, с централизованным анализом подозрительной активности и соблюдением требований 115-ФЗ.

#### 1. Уровень данных (Банковская БД)

*   **Источник:** Транзакционные базы данных Core Banking System.
*   **Механизм выгрузки:** **Change Data Capture (CDC)**. Это позволяет в реальном времени перехватывать изменения (новые транзакции) без нагрузки на основную БД.
*   **Данные:** Поток событий с полями: `transaction_id`, `client_id`, `timestamp`, `amount`, `currency`, `type`, `counterparty_id`, `counterparty_bank`, `branch_id` и т.д.

#### 2. Региональный уровень (Предварительная обработка и агрегация)

*   **Роль:** Снижение нагрузки на центральный узел, первичная фильтрация и **выявление структурных схем**.
*   **Компоненты:**
    *   **Региональный сервер приложений:** Принимает поток данных от CDC. Запускает "быстрые" правила проверки.
    *   **Локальная база данных (Кэш/БД в памяти, например, Redis):** Хранит данные по клиентам своего региона за последние N дней для анализа структурирования.

**Логика обработки на региональном сервере:**

1.  **Проверка на "быстрые" правила 115-ФЗ:**
    *   Сумма одной операции >= 1 млн руб. (или иные пороги из ст. 6).
    *   Контрагент из "проблемной" юрисдикции (сверка с внутренним списком).
    *   Прочие формальные критерии, не требующие глубокого контекста.

2.  **Анализ на структурирование (самый важный этап):**
    *   **Алгоритм:** Система агрегирует все операции по `client_id` за скользящее окно (например, 24 часа).
    *   **Правило:** Если суммарный объем операций клиента за окно превышает порог обязательного контроля (1 млн руб.), и при этом состоит из множества мелких операций, **вся цепочка операций** помечается как подозрительная.
    *   *Пример: Клиент X в филиале во Владивостоке за 2 часа совершил 10 переводов по 110 000 руб. на разные счета. Сумма > 1 млн -> все 10 операций flagged.*

3.  **Отправка данных:**
    *   В центральный узел в Москву отправляются **только** транзакции, вызвавшие срабатывание правил (п.1 или п.2), плюс необходимый для контекста набор данных о клиенте.

#### 3. Центральный уровень (Москва) - Аналитическое ядро

*   **Роль:** Глубокий контекстный анализ, скоринг рисков, формирование отчетов для Росфинмониторинга.
*   **Компоненты:**
    *   **Центральный сервер приложений:** Принимает подозрительные транзакции со всех регионов.
    *   **Центральная База Данных:** Содержит полные досье на всех клиентов банка, историю всех подозрительных операций, внутренние стоп-листы, актуальные списки Росфинмониторинга.
    *   **Скоринговая система (Rules Engine):** Присваивает клиенту и операции баллы риска на основе комплексных правил.

**Логика обработки на центральном сервере:**

1.  **Обогащение данных:** Поступающую подозрительную операцию система обогащает полной историей клиента по всем филиалам.
2.  **Проверка по центральным спискам:**
    *   Сверка клиента и контрагента с официальными перечнями (террористы, экстремисты).
    *   Проверка по внутреннему стоп-листу банка.
3.  **Комплексный скоринг:**
    *   Анализ связей: Не связаны ли контрагенты между собой? Не являются ли они частью "схемы"?
    *   Анализ поведения: Резкое изменение паттерна операций клиента.
    *   *Пример: Регион прислал операцию на 300 тыс. руб. Центральная система видит, что получатель - ИП, которое за месяц получило 50 млн от разных лиц и сразу же их обналичило. Риск операции резко возрастает.*
4.  **Принятие решения и отчетность:**
    *   Операции с высоким риском автоматически ставятся на паузу.
    *   Формируется задание для сотрудника Службы Безопасности на проверку.
    *   Готовится и отправляется сообщение в Росфинмониторинг по утвержденной форме.

Эта архитектура эффективно распределяет нагрузку, фокусируя центральные мощности на действительно сложных кейсах, и строго соответствует законодательству, автоматизируя сбор данных для 115-ФЗ.
